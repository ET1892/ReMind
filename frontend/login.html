<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="shortcut icon" type="image/x-icon" href="logo/favicon.ico">
    <link rel="stylesheet" href="universal.css">
    <style>


        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-form {
            background-color: #fff;
            padding: 35px;
            border-radius: 8px;
            width: 300px;
            text-align: center; 
        }

        .dark-mode .login-form
        {
            background-color: #000000;
            color: #fff;
        }


        body {
            transition: background-color 0.5s ease;
        }

        .login-form {
            transition: background-color 0.5s ease, color 0.5s ease;
        }


        .login-form img {
            width: 60%; 
        }

        .login-form input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .login-form button {
            width: 60%;
            padding: 8px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.5s ease;
        }

        .login-form button:hover {
            background-color: #0056b3;
        }

        .login-form .forgot-password,
        .signup-link {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        .login-form .forgot-password a,
        .signup-link a {
            color: #007bff;
            text-decoration: none;
        }

        .login-form .forgot-password a:hover,
        .signup-link a:hover {
            text-decoration: underline;
        }

        .message {
            color: green;
            font-size: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .error {
            color: red;
            font-size: 16px;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="navbar">
  <div class="navbar-logo">
    <a href="home.html">
      <img src="logo/logo.svg" alt="Logo" width="40" height="40">
    </a>
  </div>

  <!-- Flex container for the links -->
  <div class="navbar-links">
    <a href="learn.html">Learn</a>
    <a href="games.html">Games</a>
    <a href="facts.html">Facts</a>
  </div>

  <!-- Light/Dark mode toggle button in the navbar -->
  <button class="theme-toggle" id="themeToggle">
    <img id="themeIcon" src="logo/sun-icon.svg" alt="Theme Icon" width="24" height="24">
  </button>

  <!-- Login Icon placed on the rightmost side -->
  <a href="login.html" class="login-icon">
    <img src="logo/login-icon.svg" alt="Login Icon" width="24" height="24">
  </a>
</div>

<div class="content">
  <div class="login-container">
    <div class="login-form">


    <img id="loginLogo" src="logo/logoBlack.svg" alt="Logo" />
      
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>

        <div class="forgot-password">
          <a href="forgot-password.html">Forgot Password?</a>
        </div>

        <div class="signup-link">
          <p><a href="signup.html">Don't have an account? Sign Up</a></p>
        </div>
      </form>
      
      <!-- Success and error messages will appear here -->
      <div id="messageContainer"></div>
    </div>
  </div>
</div>

<script>
    const themeToggleBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const loginLogo = document.getElementById('loginLogo'); // Login page logo
    const body = document.body;
  
    // Function to update the theme based on localStorage
    function updateTheme() {
    const isDarkMode = localStorage.getItem('theme') === 'dark';

    if (isDarkMode) {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode'); // Apply dark mode
        themeIcon.src = 'logo/sun-icon.svg';
        if (loginLogo) loginLogo.src = 'logo/logo.svg'; // White logo in dark mode
    } else {
        body.classList.remove('dark-mode'); // Remove dark mode
        body.classList.add('light-mode');
        themeIcon.src = 'logo/moon-icon.svg';
        if (loginLogo) loginLogo.src = 'logo/logoBlack.svg'; // Black logo in light mode
    }
}

  
    // Load and apply saved theme on page load
    if (!localStorage.getItem('theme')) {
      localStorage.setItem('theme', 'light'); // Default to light mode if not set
    }
    updateTheme(); // Apply the correct theme on page load
  
    // Toggle theme when button is clicked
    themeToggleBtn.addEventListener('click', function () {
      const isCurrentlyDark = localStorage.getItem('theme') === 'dark';
      localStorage.setItem('theme', isCurrentlyDark ? 'light' : 'dark'); // Toggle theme in storage
      updateTheme(); // Apply changes
    });
  </script>
  


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA4XFhK_ZPpJFBz8XuYlPmH3DZDMSRYilE",
    authDomain: "remind-75124.firebaseapp.com",
    projectId: "remind-75124",
    storageBucket: "remind-75124.firebasestorage.app",
    messagingSenderId: "358342790086",
    appId: "1:358342790086:web:7d64b01f8f74d86c21c0c7"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);

  document.addEventListener("DOMContentLoaded", async function () {
    const userEmail = localStorage.getItem("userEmail");
    const uid = localStorage.getItem("uid"); // Get UID from localStorage
    const loginForm = document.getElementById("loginForm");
    const messageContainer = document.getElementById("messageContainer");

    // Check if user is signed in
    if (userEmail && uid) {
        loginForm.style.display = "none";

        messageContainer.innerHTML = `
            <div class="message">You are signed in as <strong>${userEmail}</strong></div>
            <button id="HistoryButton" style="margin-top: 10px; padding: 8px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">Game History</button>
            <button id="logoutButton" style="margin-top: 10px; padding: 8px; background-color: red; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">Logout</button>
        `;

        // Game History button event listener
        document.getElementById("HistoryButton").addEventListener("click", function () {
            window.location.href = "history.html";
        });

        // Logout button event listener
        document.getElementById("logoutButton").addEventListener("click", function () {
            signOut(auth).then(() => {
                localStorage.removeItem("userEmail");
                localStorage.removeItem("uid");
                location.reload();
            }).catch((error) => {
                console.error("Error signing out: ", error);
            });
        });
    }
});




  async function loadUserGameData() {
      const user = auth.currentUser;
      if (user) {
          const userDocRef = doc(db, "users", user.uid);
          try {
              const userDoc = await getDoc(userDocRef);
              if (userDoc.exists()) {
                  const games = userDoc.data().games || {}; // Access `games` object
                  displayGameData(games);
              } else {
                  displayGameData(null);
              }
          } catch (error) {
              console.error("Error fetching game data:", error);
              displayGameData(null);
          }
      }
  }

  function displayGameData(games) {
      const gameDataContainer = document.getElementById("gameDataContainer");
      if (!games || Object.keys(games).length === 0) {
          gameDataContainer.innerHTML = "<p>No game data found. Start playing to track your high scores!</p>";
          return;
      }

      let gameScoresHTML = "<h3>Your Best Scores:</h3><ul>";
      for (const game in games) {
          gameScoresHTML += `<li><strong>${game}:</strong> ${games[game].highestScore || 0} points</li>`;
      }
      gameScoresHTML += "</ul>";

      gameDataContainer.innerHTML = gameScoresHTML;
  }

  document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const messageContainer = document.getElementById('messageContainer');

      messageContainer.innerHTML = "";

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
          messageContainer.innerHTML = '<div class="error">Please enter a valid email address.</div>';
          return;
      }

      if (password.length < 6) {
          messageContainer.innerHTML = '<div class="error">Password must be at least 6 characters long.</div>';
          return;
      }



      //checks for UID and email before loading user data or showing the logout button, the storing of UID in local will be used for pushing the game scores

      signInWithEmailAndPassword(auth, email, password)
          .then(async (userCredential) => {
              const user = userCredential.user;
              localStorage.setItem("uid", user.uid); // Store UID in localStorage
              console.log("User signed in: ", user);

              localStorage.setItem("userEmail", email);

              // Hide login form and show success message
              document.getElementById("loginForm").style.display = "none";
              messageContainer.innerHTML = `
                  <div class="message">You have signed in as <strong>${email}</strong></div>
                  <button id="logoutButton" style="margin-top: 10px; padding: 8px; background-color: red; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">Logout</button>
                  <div id="gameDataContainer" class="message" style="margin-top: 20px;"></div>
              `;

              // Load game data after login
              await loadUserGameData();

              document.getElementById("logoutButton").addEventListener("click", function () {
                  signOut(auth).then(() => {
                      localStorage.removeItem("userEmail");
                      localStorage.removeItem("uid"); // Remove UID from local storage

                      location.reload();
                  }).catch((error) => {
                      console.error("Error signing out: ", error);
                  });
              });

              

              // Redirect to home page after successful login, after 10s
              setTimeout(() => window.location.href = "home.html", 10000);
          })
          .catch((error) => {
              const errorCode = error.code;
              console.error("Error signing in: ", errorCode);

              let errorMessage = "Invalid email or password.";

              if (errorCode === "auth/user-not-found") {
                  errorMessage = "No account found with this email. <a href='signup.html'>Sign up</a>.";
              } else if (errorCode === "auth/wrong-password") {
                  errorMessage = "Incorrect email or password.";
              } else if (errorCode === "auth/invalid-email") {
                  errorMessage = "Please enter a valid email address.";
              } else if (errorCode === "auth/too-many-requests") {
                  errorMessage = "Too many failed login attempts. Please try again later.";
              }

              messageContainer.innerHTML = `<div class="error">${errorMessage}</div>`;
          });
  });
</script>



</body>
</html>
